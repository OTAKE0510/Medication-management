<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>服薬・サプリリマインダー</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>服薬・サプリリマインダー</h1>

    <section id="add-section">
        <h2>薬を登録する</h2>
        <form id="medicine-form">
            <label for="name">薬の名前 <span style="color:red">*</span></label><br>
            <input type="text" id="name" placeholder="例：ロキソニン、ビタミンC" required><br>

            <label for="category">カテゴリ</label><br>
            <select id="category">
                <option value="">選択してください</option>
                <option value="サプリ">サプリ</option>
                <option value="処方薬">処方薬</option>
                <option value="常備薬">常備薬</option>
                <option value="その他">その他</option>
            </select><br>


            <label for="interval-type">服薬間隔</label><br>
            <select id="interval-type" name="interval-type" required>
              <option value="day">日ごと</option>
              <option value="week">週ごと</option>
              <option value="month">月ごと</option>
              <option value="tonpuku">症状時のみ（頓服薬）</option>
            </select><br>

            <label for="stock">薬の総在庫（錠数）</label><br>
            <input type="number" id="stock" min="0" placeholder="例：30" required><br>

            <label for="stockWarningThreshold">在庫警告しきい値</label><br>
            <input type="number" id="stockWarningThreshold" min="0" placeholder="例：10"><br>

            <div id="schedule-section">
              <label>服用タイミング・服用量・通知時刻</label><br>
              <div id="schedule-list"></div>
              <button type="button" id="add-schedule-btn">+ 服用タイミングを追加</button><br>
            </div>

            <div id="tonpuku-section" style="display:none;">
              <label>頓服薬専用項目</label><br>
              <label for="tonpuku-symptom">症状名</label><br>
              <input type="text" id="tonpuku-symptom" placeholder="例：頭痛、発熱など"><br>
              <label for="tonpuku-dosage">1回あたりの服用量</label><br>
              <input type="number" id="tonpuku-dosage" min="1" value="1"><br>
            </div>

            <label for="start-date">開始日</label><br>
            <input type="date" id="start-date" required><br>

            <label for="end-date">終了日</label><br>
            <input type="date" id="end-date"><br>

            <button type="submit">追加</button>
    <script>
    // 服薬間隔の選択肢表示切替・頓服薬専用UI切り替え
    document.addEventListener('DOMContentLoaded', function() {
      const intervalType = document.getElementById('interval-type');
      const dayDiv = document.getElementById('interval-day');
      const weekDiv = document.getElementById('interval-week');
      const monthDiv = document.getElementById('interval-month');
      const tonpukuSection = document.getElementById('tonpuku-section');
      const scheduleSection = document.getElementById('schedule-section');
      function updateIntervalInput() {
        dayDiv.style.display = intervalType.value === 'day' ? '' : 'none';
        weekDiv.style.display = intervalType.value === 'week' ? '' : 'none';
        monthDiv.style.display = intervalType.value === 'month' ? '' : 'none';
        tonpukuSection.style.display = intervalType.value === 'tonpuku' ? '' : 'none';
        scheduleSection.style.display = intervalType.value === 'tonpuku' ? 'none' : '';
      }
      intervalType.addEventListener('change', updateIntervalInput);
      updateIntervalInput();

      // 服用回数に応じてタイミング候補を変更
      const scheduleList = document.getElementById('schedule-list');
      const addBtn = document.getElementById('add-schedule-btn');
      function getTimingOptions() {
        if (intervalType.value === 'day') {
          return ["朝食後", "昼食後", "夕食後", "晩", "就寝前"];
        } else if (intervalType.value === 'week' || intervalType.value === 'month') {
          return ["朝", "昼", "夕", "晩", "食前", "食後", "毎食後", "就寝前"];
        } else if (intervalType.value === 'tonpuku') {
          return ["症状時"];
        }
        return ["朝食後", "昼食後", "夕食後", "晩", "就寝前", "症状時"];
      }
      function addScheduleRow() {
        const row = document.createElement('div');
        row.className = 'schedule-row';
        row.innerHTML = `<input type="text" name="timing" placeholder="例：朝、昼、夕、晩、食前、食後など自由記入"><input type="number" name="dosage" min="1" value="1" style="width:60px"> 錠 <input type="time" name="notifyTime" min="00:00" max="23:59"> <button type="button" class="remove-schedule-btn">削除</button>`;
        scheduleList.appendChild(row);
      }
      addBtn.addEventListener('click', addScheduleRow);
      scheduleList.addEventListener('click', function(e) {
        if (e.target.classList.contains('remove-schedule-btn')) {
          e.target.parentElement.remove();
        }
      });
      intervalType.addEventListener('change', function() {
        // タイミング候補を変更
        scheduleList.innerHTML = '';
        if (intervalType.value !== 'tonpuku') addScheduleRow();
      });
      // 初期1行
      if (intervalType.value !== 'tonpuku') addScheduleRow();
    });
    </script>
    <script>
    // Service Worker登録
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').then(function(reg) {
        console.log('Service Worker registered:', reg);
      });
    }
    </script>
    <script src="app.js"></script>
</body>
</html>
