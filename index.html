<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>服薬・サプリリマインダー</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>服薬・サプリリマインダー</h1>

    <section id="add-section">
        <h2>薬を登録する</h2>
        <form id="medicine-form">
            <label for="name">薬の名前 <span style="color:red">*</span></label><br>
            <input type="text" id="name" placeholder="例：ロキソニン、ビタミンC" required><br>

            <label for="category">カテゴリ</label><br>
            <input type="text" id="category" placeholder="例：サプリ、処方薬、常備薬"><br>

            <label for="dosage">1回あたりの服用量</label><br>
            <input type="number" id="dosage" placeholder="例：1、2など" min="1" required><br>

            <label for="interval-date">服薬日（複数選択可）</label><br>
            <input type="date" id="interval-date" multiple><br>
            <small style="color:#555;">服薬する日付を選択してください（複数日選択可、カンマ区切りで入力も可）</small><br>

            <label for="interval-time">服薬時刻（1日複数回の場合は追加）</label><br>
            <select id="interval-time" multiple required>
                <option value="06:00">06:00</option>
                <option value="08:00">08:00</option>
                <option value="12:00">12:00</option>
                <option value="18:00">18:00</option>
                <option value="21:00">21:00</option>
                <option value="22:00">22:00</option>
            </select><br>
            <small style="color:#555;">服薬する時刻を選択してください（CtrlやShiftで複数選択可）</small><br>

            <label for="count">薬の個数</label><br>
            <input type="number" id="count" placeholder="例：20" min="1" required><br>

            <label for="start-date">開始日</label><br>
            <input type="date" id="start-date" required><br>
            <small style="color:#555;">服薬やサプリの服用を開始する日付を入力してください</small><br>

            <label for="end-date">終了日（自動計算）</label><br>
            <input type="date" id="end-date" readonly style="background:#eee;"><br>
            <small style="color:#555;">服薬回数・間隔・個数から自動計算されます</small><br>

            <label for="notes">効果・副作用など</label><br>
            <input type="text" id="notes" placeholder="例：頭痛改善、眠気が出る等"><br>

            <label for="time">服薬時間 <span style="color:red">*</span></label><br>
            <input type="time" id="time" required><br>

            <button type="submit">追加</button>
        </form>
    </section>

    <section id="list-section">
        <h2>登録された薬一覧</h2>
        <ul id="medicine-list"></ul>
    </section>

    <script src="app.js"></script>
    <script>
    // 終了日自動計算（選択した服薬日数で計算）
    function calcEndDate() {
        const startDate = document.getElementById('start-date').value;
        const dosage = parseInt(document.getElementById('dosage').value, 10);
        const count = parseInt(document.getElementById('count').value, 10);
        // 服薬日（複数日選択可）
        let intervalDates = document.getElementById('interval-date').value;
        if (intervalDates.includes(',')) {
            intervalDates = intervalDates.split(',').map(s => s.trim()).filter(Boolean);
        } else if (intervalDates) {
            intervalDates = [intervalDates];
        } else {
            intervalDates = [];
        }
        if (!startDate || !dosage || !count || intervalDates.length === 0) {
            document.getElementById('end-date').value = '';
            return;
        }
        // 服薬日数
        const totalDays = intervalDates.length;
        // 1日分の服薬量
        // 服薬時刻の数
        const times = Array.from(document.getElementById('interval-time').selectedOptions).length || 1;
        const totalDoses = totalDays * times * dosage;
        // 実際に何日分持つか
        const daysCovered = Math.floor(count / (dosage * times));
        // 終了日
        let endDate = intervalDates[daysCovered - 1] || intervalDates[intervalDates.length - 1];
        document.getElementById('end-date').value = endDate || '';
    }
    document.getElementById('dosage').addEventListener('input', calcEndDate);
    document.getElementById('count').addEventListener('input', calcEndDate);
    document.getElementById('start-date').addEventListener('input', calcEndDate);
    document.getElementById('interval-date').addEventListener('input', calcEndDate);
    document.getElementById('interval-time').addEventListener('change', calcEndDate);
    </script>
</body>
</html>
